<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tasks/test/webdriver-io.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tasks/test/webdriver-io.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * @module tasks/test/webdriver-io
 */

/**
 * taskFactory
 * @param config {Object}
 * @returns {Function}
 * task
 */
module.exports = function(config) {
    var fs = require('fs'),
        path = require('path'),
        gulp = require('gulp'),
        webdriver = require('gulp-webdriver'),
        gutil = require('gulp-util'),
        seleniumPath = path.join(__dirname, './selenium');

    function finish() {
        process.exit(0);
    }

    function error() {
        process.exit(1);
    }

    function generateConfigFile(config) {
        var jsfy = require('jsfy');

        config.___selenium = seleniumPath;
        config.___before = config.before;

        config.before = function() {
            var self = this;
            var globals = Object.keys(self.globals);
            globals.forEach(function(key) {
                global[key] = self.globals[key];
            });
            this.___before &amp;&amp; this.___before();
        };

        if(config.seleniumStandalone) {
            config.___onPrepare = config.onPrepare;
            config.___onComplete = config.onComplete;

            config.onPrepare = function() {
                var selenium = require(this.___selenium);
                this.___onPrepare &amp;&amp; this.___onPrepare();
                return selenium.start();
            };

            config.onComplete = function() {
                var selenium = require(this.___selenium);
                selenium.stop();
                this.___onComplete &amp;&amp; this.___onComplete();
            };
        }

        return 'exports.config = ' + jsfy(config) + ';\n';
    }

    function mkdir(path) {
        return new Promise(function(resolve, reject) {
            fs.stat(path, function(err, stat) {
                if(stat &amp;&amp; stat.isDirectory()) {
                    gutil.log(gutil.colors.green(path + ' exists'));
                    resolve();
                }else {
                    fs.mkdir(path, function(err) {
                        err &amp;&amp; reject(err);
                        !err &amp;&amp; resolve();
                    });
                }
            });
        });
    }

    function writeFile(path, data) {
        return new Promise(function(resolve,reject) {
            fs.writeFile(path, data, function(err) {
                err &amp;&amp; reject(err);
                !err &amp;&amp; resolve();
            });
        });
    }

    function launchWebdriver(configPath) {
        // fix for https://github.com/webdriverio/gulp-webdriver/issues/20
        var options = { wdioBin: path.join(__dirname, '../../', 'node_modules', '.bin', 'wdio') };
        return gulp.src(configPath)
            .pipe(webdriver(options))
            .on('error', error)
            .on('finish', finish);
    }

    return function task() {
        var directoryPath = path.join(process.cwd(), './.tmp/'),
            configFilePath = directoryPath + 'test-visual-config.js';

        return mkdir(directoryPath)
            .then(function(){
                return writeFile(configFilePath, generateConfigFile(config));
            })
            .then(function() {
                return launchWebdriver(configFilePath);
            })
            .catch(function(ex) {
                gutil.log(gutil.colors.red(ex));
                error();
            });
    };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-fear-core-tasks.html">fear-core-tasks</a></li><li><a href="module-tasks_copy-inline-mocks.html">tasks/copy-inline-mocks</a></li><li><a href="module-tasks_create-app-config.html">tasks/create-app-config</a></li><li><a href="module-tasks_css.html">tasks/css</a></li><li><a href="module-tasks_css_inline.html">tasks/css/inline</a></li><li><a href="module-tasks_css_minify.html">tasks/css/minify</a></li><li><a href="module-tasks_eslint_details.html">tasks/eslint/details</a></li><li><a href="module-tasks_eslint_message-filter.html">tasks/eslint/message-filter</a></li><li><a href="module-tasks_eslint_on-change.html">tasks/eslint/on-change</a></li><li><a href="module-tasks_eslint_report.html">tasks/eslint/report</a></li><li><a href="module-tasks_eslint_result-filter.html">tasks/eslint/result-filter</a></li><li><a href="module-tasks_fs.html">tasks/fs</a></li><li><a href="module-tasks_fs_copy.html">tasks/fs/copy</a></li><li><a href="module-tasks_fs_delete.html">tasks/fs/delete</a></li><li><a href="module-tasks_html.html">tasks/html</a></li><li><a href="module-tasks_html_minify.html">tasks/html/minify</a></li><li><a href="module-tasks_html_remove.html">tasks/html/remove</a></li><li><a href="module-tasks_html_validate.html">tasks/html/validate</a></li><li><a href="module-tasks_install-dependencies.html">tasks/install-dependencies</a></li><li><a href="module-tasks_javascript.html">tasks/javascript</a></li><li><a href="module-tasks_javascript_annotate.html">tasks/javascript/annotate</a></li><li><a href="module-tasks_javascript_bundle.html">tasks/javascript/bundle</a></li><li><a href="module-tasks_javascript_minify.html">tasks/javascript/minify</a></li><li><a href="module-tasks_javascript_timestamp.html">tasks/javascript/timestamp</a></li><li><a href="module-tasks_mocks_copy-mocks.html">tasks/mocks/copy-mocks</a></li><li><a href="module-tasks_sass.html">tasks/sass</a></li><li><a href="module-tasks_sass_compile.html">tasks/sass/compile</a></li><li><a href="module-tasks_sass_lint-on-change.html">tasks/sass/lint-on-change</a></li><li><a href="module-tasks_start-karma-runner.html">tasks/start-karma-runner</a></li><li><a href="module-tasks_start-karma-server.html">tasks/start-karma-server</a></li><li><a href="module-tasks_test.html">tasks/test</a></li><li><a href="module-tasks_test_browser-sync.html">tasks/test/browser-sync</a></li><li><a href="module-tasks_test_karma-run-once.html">tasks/test/karma-run-once</a></li><li><a href="module-tasks_test_run-e2e-tests.html">tasks/test/run-e2e-tests</a></li><li><a href="module-tasks_test_sitespeed-io.html">tasks/test/sitespeed-io</a></li><li><a href="module-tasks_test_webdriver-css.html">tasks/test/webdriver-css</a></li><li><a href="module-tasks_test_webdriver-io.html">tasks/test/webdriver-io</a></li><li><a href="module-tasks_watch.html">tasks/watch</a></li><li><a href="module-tasks_watch-and-lint-on-change.html">tasks/watch-and-lint-on-change</a></li></ul><h3>Classes</h3><ul><li><a href="jsPackageHelper.html">jsPackageHelper</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jan 15 2016 20:49:04 GMT+0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
